#!/bin/bash
# M112: update touchoff

if [ -z "$1" ]; then
  echo "Error: No parameter provided."
  exit 1
fi

pipe="/home/cnc/linuxcnc/configs/xzacw/variables_pipe.json"

# read existing pipe if exists
if [ -f "$pipe" ]; then
  data=$(cat "$pipe")
else
  data="{}"
fi

# update value
echo "$data" | python3 -c "import sys,json; d=json.load(sys.stdin); d['touchoff']=$1; print(json.dumps(d))" > "$pipe"
exit 0
