#!/bin/bash
# M121: update flut from variables.txt

VARS_FILE="/home/cnc/linuxcnc/configs/xzacw/variables.txt"
serie=$(grep "^flut=" "$VARS_FILE" | cut -d '=' -f 2)

if [ -z "$serie" ]; then
  echo "Error: Failed to read flut from variables.txt"
  exit 1
fi

serie=${serie%.*}  # Remove decimal part to ensure integer

# Unlink HAL pin from signal
halcmd unlinkp gladevcp.flut

# Set the HAL pin value
halcmd setp gladevcp.flut "$serie"

# Reconnect the pin to its signal
halcmd net flut-sync gladevcp.flut

#echo "M121: Initialized flut to $serie from variables.txt"
exit 0